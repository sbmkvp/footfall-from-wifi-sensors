The primary aim of this research is to enable us to collect a series of probe requests and process them into an usable pedestrian footfall count. We do this by using a Wi-Fi receiver to collect probe requests broadcasted by mobile devices, filtering out the background noise and aggregating them based on the device that generated them. We begin by looking at the characteristics of probe requests in detail, device a methodology to collect these probe requests in public areas, examine the systemic biases and uncertainties in the data collection method and device data processing methods to overcome these challanges. Finally we compare the processed footfall counts to the ground truth recorded by primary surveys.

\subsection{Probe Requests}
Probe requests are a special type of management packets broadcast by Wi-Fi enabled devices as part of the various functions such as scanning for available access points (AP), quick geo-location by triangulation based known APs, etc.
These are broadcast by all Wi-Fi enabled devices regardless of the manufacturer, type or model of the devices though there is some variation on the frequency and the information transmitted through them.
In some cases, such as Android devices, these are broadcast even when the Wi-Fi functionality has been turned off by the user.
Thus these signals can be used to reliably identify the presence of Wi-Fi enabled mobile devices.

Being a first step of connection initiated by the mobile device, these packets have information regarding the characteristics of the mobile device itself. Some of the key information we can infer from these requests are,
\begin{enumerate}
	\item Media Access Control (MAC) address which is an unique identifier for the wireless hardware of the mobile device,
	\item Sequence number of the request for the mobile device to keep track of the responses,
	\item Timestamp at which the request was received by the AP,
	\item Total length of the request in number of bits, and 
	\item The strength of the signal which transmitted the request.
\end{enumerate}
The MAC address is the primary unique identifier for the mobile device.
It has two parts, first part gives information about the manufacturer of the device and the second is uniue to the device. The MAC address can be randomised (hence non unique) and is marked as such. Though sequence number and length of the packet are not strictly unique, we hypothesize that we can use them to estimate unique devices.

\subsection{Data Collection}
The data collection involved two processes - 
A sensor based collection of probe requests and
a manual count of pedestrians in the area next to the sensor.
We have detailed the sensor design below,

The sensor consists of wireless transponder in a linux/ MacOSX based machine
which is put into a monitor mode and
wireshark software (tshark) is used to sniff, filter and
save the relevant packets.
The filters applied are management frame to probe requests to broadcast. 
This is then parsed, personal information is hashed, 
compressed and sent to a server via web socket protocol.
The server receives, logs and stores the data in a postgresql database,
for further analysis.
The manual count was undertaken using an Android application
on a mobile phone where timestamp of every individual pedestrian footfall
was recorded by touch screen. A schematic is shown in ref figure.

\subsection{Estimating Footfall}
The next step after collecting the probe request is to estimate the footfall or pedestrian activity from them. There are three major challanges in the above data collection methodology.
the first one is deliniating the area of interest.
WiFi and its range depends on lots of factors.
need a way to isolate the noise from the relevant data. depends a lot on microsite so we need a methodology which provides us with a general solution without much tinkering.
Second one is the mac randomisation.
modern phones randomise their MAC addresses to avoid detection and tracking.
This leads to overcounting and explosion of randomised (local) mac addresses.
We need a non MAC dependent method to overcome this.
Finally, inherent mobile phone carrying bias. we need to account for the average mobile ownership. which is steadily increasing and is not 1:1.

\subsubsection{WiFi range}
One of the clues of the distance of the device generating the probe request is
the strength of the signal recieved from it.
The Signal strength varies in inverse square law over distance with a 
propagation constant.
It also depends on lot of micro site, micro temporal factors.
There cannot be a simple rule to fit and filter for all configuration.
Our hypothesis is that in a specific setting and specific source of noise,
there must exist a clear break in the data.
for example, if there is a phone shop next to our sensor where
hundreds of phones regularly send lots of probe requests
we should be able to see a large increase in number of probe requests around
a specific signal strength.
we can identify this sharp change/ break using class interval algorithms such as
k-means, jenks, quantile, etc.

\subsubsection{MAC randomisation}
This is a recent problem. ref in figure. how mac randomisation has caused problem
MAC address has been our unique identifier. Now we need to look for others.
the contenders are length, duration which seem to be unique for device
sets of known wlans and capabilites which can give us unique finger print and 
finally sequence numbers in the packets.
This is a tricky one since it is neither unique nor aggregatable.
we need a method to seperate sequences shown in fig.
We propose a graph based clustering algorithm where
each cluster corresponded to a unique device.
The algorithm creates a graph where the probe requests represented the nodes, 
and links are created between them based on the following rules: 
\begin{enumerate}
	\item A link could go only forward in time. 
	\item A link could exist between nodes with a maximum
		time difference of $\alpha$ (time threshold).
	\item A link could go from low to high sequence numbers.
	\item A link could exist between nodes with a maximum sequence
		number difference of $\beta$ (sequence threshold).
	\item A node could have only one incoming link and
		one outgoing link, which is the
		shortest of all such possible links.
\end{enumerate}
The nodes were then classified based on the unique connected component they belonged to.
This classification was assigned as the unique identifier for the anonymised probe requests
this unique identifier is used instead of MAC to aggregation.

\subsubsection{Mobile phone ownership}
This is both a long term change and result of demographic factors.
Phone ownership is not 1:1. It changes slowly overtime. It also changes
with place to place. It can be more in dense urban centers
and can be low in rural areas. We propose a adjustment factor methodology
we use periodically carried out manual counts to adjust the numbers
to what is reported on ground. The adjustment is as strong as the amount of
ground truth we collected.
